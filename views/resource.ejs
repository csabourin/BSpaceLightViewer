<!DOCTYPE html>
<html lang="<%= manifestLanguage %>">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="https://cdn.glitch.global/b8dc9c88-f259-4777-96b2-3c632dbdf057/favicon-mobile.ico?v=1688299447287">
  <link rel="stylesheet" href="/public/d2l.css" />
  <link rel="stylesheet" href="/public/resource.css" />
    <title>
        <%= courseTitle %>
    </title>
</head>

<body>
    <header role="banner" class="topbar">
        <div id="header-left">
            <a href="/"><%= manifestLanguage=="en-ca"?"Home":"Accueil" %></a>
            <button class="openbtn" onclick="openNav()" aria-label="<%= manifestLanguage=='en-ca'?'Open navigation':'Ouvrir la navigation' %>">☰</button>
        </div>
        <div class="topic-name hidden-small">
            <p>
              <%= courseTitle %>
          </p> <%= resource.title %>
        </div>
        <div id="header-right">
            <div class="nav-buttons">
                <% if (prevResource) { %>
                    <a href="/resource/<%= encodeURIComponent(prevResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></a>
                    <% } else { %>
                        <button disabled><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></button>
                        <% } %>
                            <% if (nextResource) { %>
                                <a href="/resource/<%= encodeURIComponent(nextResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></a>
                                <% } else { %>
                                    <button disabled><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></button>
                                    <% } %>
            </div>
        </div>
    </header>

<nav id="mySidebar" class="sidebar" role="navigation" aria-label="<%= manifestLanguage=='en-ca'?'Site navigation':'Navigation du site' %>">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" aria-label="<%= manifestLanguage=='en-ca'?'Close navigation':'Fermer la navigation' %>" >×</a>
    <h2><%= manifestLanguage=="en-ca"?"Table of Contents":"Table des matières" %></h2>
    <% manifest.forEach(function(module) { %>
        <h3>
            <%= module.moduleTitle %>
        </h3>
        <% function renderItems(items) { %>
            <% items.forEach(function(item) { %>
                <% if (item.type === "contentmodule") { %>
                    <h4><%= item.title %></h4>
                    <% if (item.items) { %>
                        <% renderItems(item.items); %>
                    <% } %>
                <% } else { %>
                    <a href="/resource/<%= encodeURIComponent(item.identifier) %>?lang=<%= manifestLanguage %>">
                        <%= item.title %>
                    </a>
                <% } %>
            <% }); %>
        <% } %>
        <% renderItems(module.items); %>
    <% }); %>
</nav>
    <main id="main" role="main">


        <iframe src="/page/<%= resource.href %>"></iframe>
        <div class="nav-buttons">
            <% if (prevResource) { %>
                <a href="/resource/<%= encodeURIComponent(prevResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></a>
                <% } else { %>
                    <button disabled><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></button>
                    <% } %>
                        <% if (nextResource) { %>
                            <a href="/resource/<%= encodeURIComponent(nextResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></a>
                            <% } else { %>
                                <button disabled><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></button>
                                <% } %>
        </div>
    </main>

<script>
    function openNav() {
        document.getElementById("mySidebar").style.width = "450px";
        document.getElementById("main").style.marginLeft = "450px";
        localStorage.setItem('sidebarStatus', 'open'); // save the sidebar status
    }

    function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
        localStorage.setItem('sidebarStatus', 'closed'); // save the sidebar status
    }
</script>

    <script>
        window.onload = function () {
            var currentPageTitle = '<%= currentPage %>'; // get the current page title from the server-side data
            localStorage.setItem(currentPageTitle, 'visited'); // mark the current page as visited

            // Get all links in the sidebar
            var links = document.getElementById('mySidebar').getElementsByTagName('a');

            for (var i = 0; i < links.length; i++) {
                var title = links[i].textContent.trim();
                if (localStorage.getItem(title) === 'visited') {
                    // Add a checkmark after the link
                    links[i].innerHTML += ' ✓';
                }
            }
                  // Check the saved sidebar status and open the sidebar if it was previously open
        // var sidebarStatus = localStorage.getItem('sidebarStatus');
        // if (sidebarStatus === 'open') {
        //     openNav();
        // }
        }
    </script>

</body>

</html>