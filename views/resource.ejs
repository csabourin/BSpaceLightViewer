<!DOCTYPE html>
<html lang="<%= manifestLanguage %>">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/public/favicon-mobile.ico">
  <link rel="stylesheet" href="/public/d2l.css" />
  <link rel="stylesheet" href="/public/resource.css" />
    <title>
        <%= courseTitle %>
    </title>
</head>

<body>
    <header role="banner" class="topbar">
        <div id="header-left">
            <a href="/"><%= manifestLanguage=="en-ca"?"Home":"Accueil" %></a>
            <button class="openbtn" onclick="openNav()" aria-label="<%= manifestLanguage=='en-ca'?'Open navigation':'Ouvrir la navigation' %>">☰</button>
        </div>
        <div class="topic-name hidden-small">
            <p>
              <%= courseTitle %>
                </p> <p><%= resource.title %></p>
        </div>
        <div id="header-right">
            <div class="nav-buttons">
                <% if (prevResource) { %>
                    <a data-direction='prev' href="/resource/<%= encodeURIComponent(prevResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></a>
                    <% } else { %>
                        <button data-direction="prev" disabled><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></button>
                        <% } %>
                            <% if (nextResource) { %>
                                <a data-direction='next' href="/resource/<%= encodeURIComponent(nextResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></a>
                                <% } else { %>
                                    <button data-direction="next" disabled><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></button>
                                    <% } %>
            </div>
        </div>
    </header>

<nav id="mySidebar" class="sidebar" role="navigation" aria-label="<%= manifestLanguage=='en-ca'?'Site navigation':'Navigation du site' %>">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" aria-label="<%= manifestLanguage=='en-ca'?'Close navigation':'Fermer la navigation' %>" >×</a>
  <div class="sideContainer">  
  <h2><%= manifestLanguage=="en-ca"?"Table of Contents":"Table des matières" %></h2>
    <% manifest.forEach(function(module) { %>
        <h3>
            <%= module.moduleTitle %>
        </h3>
        <% function renderItems(items) { %>
            <% items.forEach(function(item) { %>
                <% if (item.type === "contentmodule") { %>
                    <h4><%= item.title %></h4>
                    <% if (item.items) { %>
                        <% renderItems(item.items); %>
                    <% } %>
                <% } else { %>
                    <a href="/resource/<%= encodeURIComponent(item.identifier) %>?lang=<%= manifestLanguage %>">
                        <%= item.title %>
                    </a>
                <% } %>
            <% }); %>
        <% } %>
        <% renderItems(module.items); %>
    <% }); %>
    </div>
      <hr class="endcourse" />
</nav>
    <main id="main" role="main">


        <iframe src="/page/<%= resource.href %>"></iframe>
        <div class="nav-buttons">
            <% if (prevResource) { %>
                <a data-direction='prev' href="/resource/<%= encodeURIComponent(prevResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></a>
                <% } else { %>
                    <button data-direction="prev" disabled><%= manifestLanguage=="en-ca"?"Previous":"Précédent" %></button>
                    <% } %>
                        <% if (nextResource) { %>
                            <a data-direction='next' href="/resource/<%= encodeURIComponent(nextResource.identifier) %>?lang=<%= manifestLanguage %>"><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></a>
                            <% } else { %>
                                <button data-direction="next" disabled><%= manifestLanguage=="en-ca"?"Next":"Suivant" %></button>
                                <% } %>
        </div>
    </main>

<script>
  var sidebar = document.querySelector(".sidebar");
  var main = document.querySelector("#main");
    function openNav() {
        sidebar.classList.toggle("open");
        main.classList.toggle("open");
        localStorage.setItem('sidebarStatus', 'open'); // save the sidebar status
    }

    function closeNav() {
        sidebar.classList.toggle("open");
        main.classList.toggle("open");
        localStorage.setItem('sidebarStatus', 'closed'); // save the sidebar status
    }
</script>

    <script>
      window.onload = function () {
    var currentPageTitle = '<%= currentPage %>'; // get the current page resource from the server-side data
    localStorage.setItem(currentPageTitle, 'visited'); // mark the current page as visited

    // Get all links in the sidebar
    var links = document.getElementById('mySidebar').getElementsByTagName('a');

    for (var i = 0; i < links.length; i++) {
        var url = new URL(links[i].href); // Create URL object from href
        var pathParts = url.pathname.split('/'); // Split the path into parts
        var resourceId = pathParts[pathParts.length - 1]; // The resource ID is the last part of the path

        if (localStorage.getItem(resourceId) === 'visited') {
            // Add a checkmark after the link
            links[i].innerHTML += ' ✓';
        }
    }
}
                  // Check the saved sidebar status and open the sidebar if it was previously open
        // var sidebarStatus = localStorage.getItem('sidebarStatus');
        // if (sidebarStatus === 'open') {
        //     openNav();
        // }
        
    </script>

</body>

</html>